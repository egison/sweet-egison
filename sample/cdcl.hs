{-# LANGUAGE DataKinds #-}
{-# LANGUAGE FlexibleContexts #-}
{-# LANGUAGE FlexibleInstances #-}
{-# LANGUAGE MultiParamTypeClasses #-}
{-# LANGUAGE QuasiQuotes #-}
{-# LANGUAGE TupleSections #-}
{-# LANGUAGE TypeFamilies #-}

import Control.Egison
import Control.Monad (MonadPlus (..))
import Data.List
  ( sortBy,
    union,
  )
import Debug.Trace (trace)

data Literal = Literal

instance (Eq a) => Matcher Literal a

instance (Eq a) => ValuePattern Literal a

-- Stage matcher = Eql matcher
data Stage = Stage

instance (Eq a) => Matcher Stage a

instance (Eq a) => ValuePattern Stage a

-- Matchers for assignments
type TaggedLiteral = (Integer, Integer) -- a tuple of a variable and a stage

data Assign
  = Deduced TaggedLiteral [TaggedLiteral]
  | Guessed TaggedLiteral
  deriving (Show)

data Assignment = Assignment

instance Matcher Assignment Assign

deduced ::
  Pattern
    (PP (Integer, Integer), PP [(Integer, Integer)])
    Assignment
    Assign
    ((Integer, Integer), [(Integer, Integer)])
deduced _ _ (Deduced l ls) = pure (l, ls)
deduced _ _ _ = mzero

deducedM Assignment _ = (Pair Literal Stage, Multiset (Pair Literal Stage))

guessed :: Pattern (PP (Integer, Integer)) Assignment Assign (Integer, Integer)
guessed _ _ (Guessed l) = pure l
guessed _ _ _ = mzero

guessedM Assignment _ = Pair Literal Stage

whichever ::
  Pattern (PP (Integer, Integer)) Assignment Assign (Integer, Integer)
whichever _ _ (Deduced l _) = pure l
whichever _ _ (Guessed l) = pure l

whicheverM Assignment _ = Pair Literal Stage

--
-- VSIDS
--
toCNF :: [[Integer]] -> [([Integer], [Integer])]
toCNF = map (\c -> (c, c))

fromCNF :: [([Integer], [Integer])] -> [[Integer]]
fromCNF = map fst

initVars :: [Integer] -> [(Integer, Integer)]
initVars vs = map ((,0) . negate) vs ++ map (,0) vs

addVars :: [Integer] -> [(Integer, Integer)] -> [(Integer, Integer)]
addVars vs vars =
  match
    dfs
    (vs, vars)
    (Pair (List Literal) (List (Pair Literal Eql)))
    [ [mc| ([], _) -> sortBy (\(_, c1) (_, c2) -> opposite (compare c1 c2)) vars |],
      [mc| ($v : $vs2, $hs ++ (#v, $c) : $ts) ->
          addVars vs2 (hs ++ (v, c + 1) : ts) |]
    ]
  where
    opposite LT = GT
    opposite GT = LT
    opposite EQ = EQ

deleteVar :: Integer -> [(Integer, Integer)] -> [(Integer, Integer)]
deleteVar v vars =
  match
    dfs
    vars
    (Multiset (Pair Literal Eql))
    [[mc| (#v, _) : (#(negate v), _) : $vars2 -> vars2 |]]

--
-- Utility functions for literals and cnfs
--
getStage :: Integer -> [Assign] -> Integer
getStage l trail =
  match
    dfs
    trail
    (List Assignment)
    [[mc| _ ++ whichever (#(negate l), $s) : _ -> s |]]

deleteLiteral :: Integer -> [([Integer], [Integer])] -> [([Integer], [Integer])]
deleteLiteral l cnf =
  map
    ( \(c1, c2) ->
        (matchAll dfs c1 (Multiset Literal) [[mc| (!#l & $m) : _ -> m |]], c2)
    )
    cnf

deleteClausesWith ::
  Integer -> [([Integer], [Integer])] -> [([Integer], [Integer])]
deleteClausesWith l cnf =
  matchAll
    dfs
    cnf
    (Multiset (Pair (Multiset Literal) (Multiset Literal)))
    [[mc| ((!(#l : _), _) & $c) : _ -> c |]]

assignTrue :: Integer -> [([Integer], [Integer])] -> [([Integer], [Integer])]
assignTrue l cnf = deleteLiteral (negate l) (deleteClausesWith l cnf)

--
-- Unit propagation
--
unitPropagate ::
  Integer ->
  [([Integer], [Integer])] ->
  [Assign] ->
  ([([Integer], [Integer])], [Assign])
unitPropagate stage cnf trail = unitPropagate' stage cnf trail trail

unitPropagate' ::
  Integer ->
  [([Integer], [Integer])] ->
  [Assign] ->
  [Assign] ->
  ([([Integer], [Integer])], [Assign])
unitPropagate' stage cnf trail otrail =
  match
    dfs
    trail
    (List Assignment)
    [ [mc| whichever ($l, _) : $trail2 -> unitPropagate' stage (assignTrue l cnf) trail2 otrail |],
      [mc| _ -> unitPropagate'' stage cnf otrail |]
    ]

unitPropagate'' ::
  Integer ->
  [([Integer], [Integer])] ->
  [Assign] ->
  ([([Integer], [Integer])], [Assign])
unitPropagate'' stage cnf trail =
  match
    dfs
    cnf
    (Multiset (Pair (Multiset Literal) (Multiset Literal)))
    [ [mc| ([], _) : _ -> (cnf, trail) |],
      [mc| ($l : [], #l : $rs) : _ ->
          unitPropagate'' stage (assignTrue l cnf) 
                          ([(Deduced (l, stage) (map (\r -> (r, (getStage r trail))) rs))] ++ trail) |],
      [mc| _ -> (cnf, trail) |]
    ]

--
-- Learning
--

learn :: Integer -> [(Integer, Integer)] -> [Assign] -> (Integer, [Integer])
learn stage cl trail =
  match
    dfs -- must be match dfs
    (trail, cl)
    (Pair (List Assignment) (Multiset (Pair Literal Eql)))
    [ [mc| (_, !((_, #stage) : (_, #stage) : _)) ->
          (minimum (map (\(_, c) -> c) cl), map (\(l, _) -> l) cl) |],
      [mc| (_ ++ deduced ($l, #stage) $ds : $trail2,
               (#(negate l), #stage) : $rs) ->
          learn stage (union rs ds) trail2 |]
    ]

--
-- Backjumping
--

backjump :: Integer -> [Assign] -> [Assign]
backjump stage trail =
  match
    dfs
    trail
    (List Assignment)
    [ [mc| _ ++ ((guessed (_, #stage) : _) & $trail2) -> trail2 |],
      [mc| _ -> [] |]
    ]

--
-- Guess
--

guess vars trail =
  match
    dfs -- must be match dfs
    (vars, trail)
    (Pair (List (Pair Literal Eql)) (List Assignment))
    [ [mc| (_ ++ ($l, _) : _,
               (!(_ ++ whichever ((#l | #(negate l)), _) : _))) ->
          negate l |]
    ]

--
-- CDCL main
--

cdcl :: [Integer] -> [[Integer]] -> Bool
cdcl vars cnf = cdcl' 0 0 (initVars vars) (toCNF cnf) []

cdcl' ::
  Integer ->
  Integer ->
  [(Integer, Integer)] ->
  [([Integer], [Integer])] ->
  [Assign] ->
  Bool
cdcl' count stage vars cnf trail =
  match
    dfs
    (cnf2, trail2)
    ( Pair
        (Multiset (Pair (Multiset Literal) (Multiset Literal)))
        (List Assignment)
    )
    [ [mc| ([], _) -> True |],
      [mc| (([], $cc) : _, _ ++ guessed ($l, #stage) : $trail3) ->
            let (s, lc) = learn stage (map (\l -> (l, (getStage l trail2))) cc) trail2 in
            let trail4 = backjump s trail3 in
              cdcl' (count + 1) s (addVars lc vars) ((lc, lc):cnf) trail4 |],
      [mc| (([], $cc) : _, _) -> False |],
      [mc| _ ->
            let g = guess vars trail2 in
              cdcl' (count + 1) (stage + 1) vars cnf (Guessed (g, stage + 1):trail2) |]
    ]
  where
    (cnf2, trail2) = unitPropagate stage cnf trail

-- where (cnf2, trail2) = unitPropagate stage cnf (trace (show trail) trail) in -- debug

main :: IO ()
main = do
  --  print $ cdcl [] []
  --  print $ cdcl [] [[]]
  --  print $ cdcl [1] [[1]]
  --  print $ cdcl [1, 2] [[1], [1, 2]]
  --  print "Problem 20"
  --  print $ cdcl [1 .. 20] problem20 -- 0.025
  --  print "Problem 50"
  --  print $ cdcl [1 .. 50] problem50 -- 0.085
  --  print "Problem 75"
  --  print $ cdcl [1 .. 75] problem75 -- 0.096
  --  print "Problem 75'"
  --  print $ cdcl [1 .. 75] problem75' -- 0.732
  print "Problem 100"
  print $ cdcl [1 .. 100] problem100 -- 15.876

problem20 =
  [ [4, -18, 19],
    [3, 18, -5],
    [-5, -8, -15],
    [-20, 7, -16],
    [10, -13, -7],
    [-12, -9, 17],
    [17, 19, 5],
    [-16, 9, 15],
    [11, -5, -14],
    [18, -10, 13],
    [-3, 11, 12],
    [-6, -17, -8],
    [-18, 14, 1],
    [-19, -15, 10],
    [12, 18, -19],
    [-8, 4, 7],
    [-8, -9, 4],
    [7, 17, -15],
    [12, -7, -14],
    [-10, -11, 8],
    [2, -15, -11],
    [9, 6, 1],
    [-11, 20, -17],
    [9, -15, 13],
    [12, -7, -17],
    [-18, -2, 20],
    [20, 12, 4],
    [19, 11, 14],
    [-16, 18, -4],
    [-1, -17, -19],
    [-13, 15, 10],
    [-12, -14, -13],
    [12, -14, -7],
    [-7, 16, 10],
    [6, 10, 7],
    [20, 14, -16],
    [-19, 17, 11],
    [-7, 1, -20],
    [-5, 12, 15],
    [-4, -9, -13],
    [12, -11, -7],
    [-5, 19, -8],
    [1, 16, 17],
    [20, -14, -15],
    [13, -4, 10],
    [14, 7, 10],
    [-5, 9, 20],
    [10, 1, -19],
    [-16, -15, -1],
    [16, 3, -11],
    [-15, -10, 4],
    [4, -15, -3],
    [-10, -16, 11],
    [-8, 12, -5],
    [14, -6, 12],
    [1, 6, 11],
    [-13, -5, -1],
    [-7, -2, 12],
    [1, -20, 19],
    [-2, -13, -8],
    [15, 18, 4],
    [-11, 14, 9],
    [-6, -15, -2],
    [5, -12, -15],
    [-6, 17, 5],
    [-13, 5, -19],
    [20, -1, 14],
    [9, -17, 15],
    [-5, 19, -18],
    [-12, 8, -10],
    [-18, 14, -4],
    [15, -9, 13],
    [9, -5, -1],
    [10, -19, -14],
    [20, 9, 4],
    [-9, -2, 19],
    [-5, 13, -17],
    [2, -10, -18],
    [-18, 3, 11],
    [7, -9, 17],
    [-15, -6, -3],
    [-2, 3, -13],
    [12, 3, -2],
    [-2, -3, 17],
    [20, -15, -16],
    [-5, -17, -19],
    [-20, -18, 11],
    [-9, 1, -5],
    [-19, 9, 17],
    [12, -2, 17],
    [4, -16, -5]
  ]

problem50 =
  [ [18, -8, 29],
    [-16, 3, 18],
    [-36, -11, -30],
    [-50, 20, 32],
    [-6, 9, 35],
    [42, -38, 29],
    [43, -15, 10],
    [-48, -47, 1],
    [-45, -16, 33],
    [38, 42, 22],
    [-49, 41, -34],
    [12, 17, 35],
    [22, -49, 7],
    [-10, -11, -39],
    [-28, -36, -37],
    [-13, -46, -41],
    [21, -4, 9],
    [12, 48, 10],
    [24, 23, 15],
    [-8, -41, -43],
    [-44, -2, -35],
    [-27, 18, 31],
    [47, 35, 6],
    [-11, -27, 41],
    [-33, -47, -45],
    [-16, 36, -37],
    [27, -46, 2],
    [15, -28, 10],
    [-38, 46, -39],
    [-33, -4, 24],
    [-12, -45, 50],
    [-32, -21, -15],
    [8, 42, 24],
    [30, -49, 4],
    [45, -9, 28],
    [-33, -47, -1],
    [1, 27, -16],
    [-11, -17, -35],
    [-42, -15, 45],
    [-19, -27, 30],
    [3, 28, 12],
    [48, -11, -33],
    [-6, 37, -9],
    [-37, 13, -7],
    [-2, 26, 16],
    [46, -24, -38],
    [-13, -24, -8],
    [-36, -42, -21],
    [-37, -19, 3],
    [-31, -50, 35],
    [-7, -26, 29],
    [-42, -45, 29],
    [33, 25, -6],
    [-45, -5, 7],
    [-7, 28, -6],
    [-48, 31, -11],
    [32, 16, -37],
    [-24, 48, 1],
    [18, -46, 23],
    [-30, -50, 48],
    [-21, 39, -2],
    [24, 47, 42],
    [-36, 30, 4],
    [-5, 28, -1],
    [-47, 32, -42],
    [16, 37, -22],
    [-43, 42, -34],
    [-40, 39, -20],
    [-49, 29, 6],
    [-41, -3, 39],
    [-16, -12, 43],
    [24, 22, 3],
    [47, -45, 43],
    [45, -37, 46],
    [-9, 26, 5],
    [-3, 23, -13],
    [5, -34, 13],
    [12, 39, 13],
    [22, 50, 37],
    [19, 9, 46],
    [-24, 8, -27],
    [-28, 7, 21],
    [8, -25, 50],
    [20, 50, 4],
    [27, 36, 13],
    [26, 31, -25],
    [39, -44, -32],
    [-20, 41, -10],
    [49, -28, 35],
    [1, 44, 34],
    [39, 35, -11],
    [-50, -42, -7],
    [-24, 7, 47],
    [-13, 5, -48],
    [-9, -20, -23],
    [2, 17, -19],
    [11, 23, 21],
    [-45, 30, 15],
    [11, 26, -24],
    [38, 33, -13],
    [44, -27, -7],
    [41, 49, 2],
    [-18, 12, -37],
    [-2, 12, -26],
    [-19, 7, 32],
    [-22, 11, 33],
    [8, 12, -20],
    [16, 40, -48],
    [-2, -24, -11],
    [26, -17, 37],
    [-14, -19, 46],
    [5, 47, 36],
    [-29, -9, 19],
    [32, 4, 28],
    [-34, 20, -46],
    [-4, -36, -13],
    [-15, -37, 45],
    [-21, 29, 23],
    [-6, -40, 7],
    [-42, 31, -29],
    [-36, 24, 31],
    [-45, -37, -1],
    [3, -6, -29],
    [-28, -50, 27],
    [44, 26, 5],
    [-17, -48, 49],
    [12, -40, -7],
    [-12, 31, -48],
    [27, 32, -42],
    [-27, -10, 1],
    [6, -49, 10],
    [-24, 8, 43],
    [23, 31, 1],
    [11, -47, 38],
    [-28, 26, -13],
    [-40, 12, -42],
    [-3, 39, 46],
    [17, 41, 46],
    [23, 21, 13],
    [-14, -1, -38],
    [20, 18, 6],
    [-50, 20, -9],
    [10, -32, -18],
    [-21, 49, -34],
    [44, 23, -35],
    [40, -19, 34],
    [-1, 6, -12],
    [6, -2, -7],
    [32, -20, 34],
    [-12, 43, -29],
    [24, 2, -49],
    [10, -4, 40],
    [11, 5, 12],
    [-3, 47, -31],
    [43, -23, 21],
    [-41, -36, -50],
    [-8, -42, -24],
    [39, 45, 7],
    [7, 37, -45],
    [41, 40, 8],
    [-50, -10, -8],
    [-5, -39, -14],
    [-22, -24, -43],
    [-36, 40, 35],
    [17, 49, 41],
    [-32, 7, 24],
    [-30, -8, -9],
    [-41, -13, -10],
    [31, 26, -33],
    [17, -22, -39],
    [-21, 28, 3],
    [-14, 46, 23],
    [29, 16, 19],
    [42, -32, -44],
    [-24, 10, 23],
    [-1, -32, -21],
    [-8, -44, -39],
    [39, 11, 9],
    [19, 14, -46],
    [46, 44, -42],
    [37, 23, -29],
    [32, 25, 20],
    [14, -43, -12],
    [-36, -18, 46],
    [14, -26, -10],
    [-2, -30, 5],
    [6, -18, 46],
    [-26, 2, -44],
    [20, -8, -11],
    [-31, 3, 16],
    [-22, -9, 39],
    [-49, 44, -42],
    [-45, -44, 31],
    [-31, 50, -11],
    [-32, -46, 2],
    [-6, -7, 17],
    [19, -32, 48],
    [39, 20, -10],
    [-22, -37, 38],
    [-31, 9, -48],
    [40, 12, 7],
    [-24, -4, 9],
    [-22, 49, 33],
    [-12, 43, 10],
    [25, -30, -10],
    [46, 47, 31],
    [13, 27, -7],
    [-45, 32, -35],
    [-50, 34, 9],
    [2, 34, 30],
    [3, 16, 2],
    [-18, 45, -12],
    [33, 37, 10],
    [43, 7, -18],
    [-22, 44, -19],
    [-31, -27, -42],
    [-3, -40, 8],
    [-23, -31, 38]
  ]

problem75 =
  [ [42, 22, 15],
    [73, -22, -24],
    [50, -20, 53],
    [-66, 49, -15],
    [39, 8, -74],
    [66, 72, -61],
    [-32, -13, -8],
    [44, -22, -1],
    [-42, 35, -20],
    [-40, -42, 57],
    [-3, -52, 7],
    [-50, -14, 34],
    [-39, -37, -28],
    [10, 25, 31],
    [-3, 45, -75],
    [69, -10, 39],
    [-22, 47, 34],
    [62, 67, -64],
    [-11, -39, 72],
    [-75, -70, -47],
    [61, -47, -65],
    [43, -70, -33],
    [28, -37, 53],
    [-63, 62, -46],
    [62, 28, 33],
    [13, 12, 57],
    [64, 4, -23],
    [-7, -32, 34],
    [66, 36, 71],
    [74, -7, 51],
    [41, -53, -15],
    [-50, -44, -53],
    [70, -72, -14],
    [37, 47, -23],
    [56, -7, 50],
    [-34, 4, -67],
    [23, -1, 15],
    [-58, 67, -2],
    [58, 56, 29],
    [49, 69, 43],
    [36, 59, 10],
    [74, -55, 35],
    [19, 38, -24],
    [2, 17, 24],
    [66, 70, -30],
    [39, -53, 48],
    [4, 51, -42],
    [-36, 68, -22],
    [57, -43, -13],
    [1, 59, -4],
    [-73, -53, 22],
    [53, 62, 68],
    [-18, 40, -16],
    [-29, 2, -10],
    [15, -13, -57],
    [1, 45, 34],
    [40, 68, 4],
    [-55, -29, -47],
    [-37, -21, 68],
    [44, 2, -17],
    [-7, -20, -33],
    [-57, -7, -40],
    [-67, 18, -4],
    [31, 50, 17],
    [-28, 65, 5],
    [-34, -21, 43],
    [39, 43, -16],
    [-54, -19, 72],
    [-54, 13, 59],
    [74, 64, 69],
    [-28, 66, 71],
    [20, 56, -21],
    [-2, 26, 71],
    [37, -21, -64],
    [31, 44, -62],
    [-62, -67, 22],
    [62, 68, 15],
    [6, -17, -48],
    [-6, -37, -1],
    [-63, -24, 26],
    [-43, 46, -19],
    [-25, 14, 60],
    [62, 26, 17],
    [15, 33, -53],
    [73, -15, -70],
    [-50, 31, -24],
    [-61, 45, 64],
    [-45, 70, -33],
    [-4, -44, -17],
    [27, 56, -57],
    [75, -53, 1],
    [-73, 32, -66],
    [69, 46, 70],
    [11, 36, -66],
    [-70, -44, 31],
    [21, 65, -12],
    [43, -11, 14],
    [34, 65, 61],
    [-50, -27, -54],
    [-16, 48, 39],
    [4, -45, 17],
    [74, -35, 39],
    [27, -26, -25],
    [31, -28, -69],
    [-4, -9, -20],
    [70, -58, 13],
    [41, 72, 39],
    [-39, -35, 57],
    [31, 3, -63],
    [71, -16, -65],
    [-59, -53, 27],
    [-75, 29, 22],
    [-69, -72, 65],
    [-11, -16, -39],
    [-55, -34, -66],
    [-13, 32, 26],
    [65, -28, -43],
    [40, 59, -71],
    [66, -45, 72],
    [-5, -22, -69],
    [-44, -3, 74],
    [-9, -32, -53],
    [-50, 7, -26],
    [27, -26, -30],
    [-58, -60, 18],
    [18, 25, -11],
    [42, 27, -10],
    [62, 52, 58],
    [73, -50, 44],
    [-23, 55, -9],
    [-49, -48, 13],
    [-37, -30, -58],
    [23, -35, -37],
    [-23, -45, 34],
    [16, -19, -10],
    [13, 33, -12],
    [-56, 53, 29],
    [-23, -47, 37],
    [44, -74, -54],
    [-33, 6, -68],
    [7, -42, 10],
    [-18, 47, 4],
    [49, 32, -74],
    [-20, -60, -49],
    [-48, -20, -44],
    [18, 69, 40],
    [-52, 30, 1],
    [8, -50, -42],
    [55, 5, 43],
    [67, 50, 36],
    [-33, -31, 73],
    [37, -71, -29],
    [24, 46, -5],
    [9, 34, -31],
    [-28, 12, -36],
    [22, -60, -28],
    [-46, 5, -65],
    [-38, -45, -31],
    [-30, -7, -20],
    [47, -72, 67],
    [4, 6, -3],
    [25, -71, -52],
    [75, -32, -42],
    [16, 28, 47],
    [16, -60, -12],
    [26, 70, 2],
    [-75, -50, 21],
    [48, 64, -46],
    [54, -35, 72],
    [-41, 10, -69],
    [-48, -43, 54],
    [74, -70, -54],
    [34, 18, -32],
    [-48, 11, 10],
    [-54, -2, 14],
    [32, -25, -73],
    [-15, 72, 63],
    [-37, -49, 51],
    [-43, -25, -17],
    [-55, 47, 54],
    [23, -50, -56],
    [14, -1, -50],
    [34, 30, 38],
    [15, -65, 40],
    [-9, 20, 4],
    [-19, -35, -72],
    [53, -68, -58],
    [-18, 27, 6],
    [71, 51, -18],
    [-67, 16, 3],
    [17, 21, 50],
    [-71, 73, 22],
    [28, 42, -34],
    [-18, -52, -4],
    [43, 75, 64],
    [-54, -24, 52],
    [-62, -40, -27],
    [67, -32, 8],
    [12, -71, -61],
    [-1, -15, -44],
    [-67, 30, 69],
    [50, -7, -2],
    [-42, -36, -22],
    [-59, 72, -71],
    [-14, 12, 57],
    [28, 68, 62],
    [-59, 11, -14],
    [-51, 54, 19],
    [-72, -12, 2],
    [34, -69, 25],
    [48, 4, -19],
    [-41, -9, 66],
    [-37, -45, 57],
    [-61, 38, 21],
    [75, 64, -69],
    [-50, 51, -48],
    [-48, 51, -6],
    [41, -66, 44],
    [32, 48, -52],
    [-17, -67, 47],
    [16, -46, -63],
    [56, -31, -66],
    [60, 50, -33],
    [39, -53, 15],
    [-68, -12, 8],
    [-54, 68, 49],
    [26, -56, -60],
    [-6, -59, -19],
    [6, -29, 17],
    [-37, 23, -45],
    [54, -68, -22],
    [-46, -49, 35],
    [67, 32, -23],
    [-36, 52, 3],
    [-18, -57, 38],
    [-35, 30, 57],
    [25, -71, -67],
    [3, 1, 17],
    [-69, 74, 6],
    [-67, -75, 58],
    [-14, -15, -50],
    [26, 18, 68],
    [12, -31, -37],
    [31, 57, 58],
    [-58, -22, -1],
    [60, 14, -71],
    [31, -34, 7],
    [60, 63, -66],
    [-6, 47, -36],
    [66, -12, 30],
    [25, 43, 48],
    [-67, -39, 27],
    [-30, -65, -34],
    [17, -4, 28],
    [-16, 5, -9],
    [59, -41, -24],
    [-35, 64, 19],
    [72, 61, -7],
    [70, -47, -54],
    [-40, -12, -52],
    [-30, -41, 34],
    [-34, 31, -21],
    [69, -13, -37],
    [50, -37, 39],
    [-1, -24, 47],
    [46, 27, -69],
    [-35, 38, 21],
    [-32, 8, 49],
    [60, 58, -54],
    [59, -12, -62],
    [-60, 34, 11],
    [-43, -72, -54],
    [-24, 8, 1],
    [-15, 61, 67],
    [31, 68, 14],
    [1, -8, -35],
    [27, 28, -69],
    [-72, 39, -53],
    [-6, -51, -39],
    [74, -40, 12],
    [17, -71, -48],
    [-54, 8, 38],
    [55, -61, -52],
    [-72, -3, -55],
    [-39, 15, 65],
    [70, -74, 51],
    [-1, 62, -57],
    [38, 70, 50],
    [-73, -13, -15],
    [30, -16, 4],
    [-23, 64, -5],
    [-17, -11, -46],
    [63, -31, -50],
    [-50, 42, -4],
    [-54, -48, -70],
    [-63, 15, -53],
    [52, 30, -74],
    [-3, -16, -22],
    [-43, 26, -34],
    [26, -68, 25],
    [-9, 38, -32],
    [-49, 7, 73],
    [-38, 31, 41],
    [52, 50, -44],
    [62, -46, 51],
    [-29, -75, 63],
    [29, 34, -25],
    [52, 43, 9],
    [35, 4, 66],
    [61, 75, -57],
    [-62, 40, 46],
    [68, 54, -64],
    [69, -58, -37],
    [18, 34, 67],
    [20, -22, 5],
    [47, 45, 55],
    [48, 12, -58],
    [-31, 22, -45],
    [-55, -42, -4],
    [-51, -69, -61],
    [-70, -41, 14],
    [54, -31, -44],
    [-25, 22, -18],
    [-39, -68, -8],
    [-6, -15, -51]
  ]

problem75' =
  [ [40, -50, 57],
    [45, 7, -39],
    [24, -42, 26],
    [25, 29, 56],
    [-16, -28, 35],
    [40, 9, 64],
    [54, 67, 43],
    [-14, -33, -42],
    [48, 1, 70],
    [-36, 27, 56],
    [-8, -53, -33],
    [-32, -52, -47],
    [-1, -7, -14],
    [9, -18, 65],
    [31, -6, -27],
    [-35, 8, 17],
    [48, 36, -67],
    [1, 36, 66],
    [-3, 11, 54],
    [68, -44, 29],
    [-58, 15, -36],
    [14, -56, 75],
    [-65, 1, -71],
    [17, 10, 70],
    [1, -68, -46],
    [3, -62, -35],
    [16, -49, 74],
    [-11, -49, 31],
    [8, 4, -39],
    [-20, 13, 54],
    [64, 34, 12],
    [22, -52, 54],
    [55, -8, -1],
    [39, 7, 67],
    [-64, 29, -16],
    [68, 8, -6],
    [-9, -53, 18],
    [14, -53, 23],
    [-2, 26, 28],
    [71, -16, 66],
    [-58, -50, -17],
    [-29, -62, 25],
    [61, 62, -1],
    [-29, -2, -14],
    [18, 66, -57],
    [17, -59, -14],
    [6, -1, 53],
    [-53, -32, 12],
    [-41, -68, 14],
    [21, -67, 74],
    [-42, -17, 59],
    [47, 56, 32],
    [-49, -63, -35],
    [72, -6, -67],
    [19, 6, 33],
    [18, 49, 2],
    [74, 4, -63],
    [-72, -1, 25],
    [-54, 47, -16],
    [7, -37, -13],
    [-41, -17, -19],
    [-74, -43, -46],
    [51, -63, 61],
    [-25, 23, 73],
    [21, -18, 66],
    [3, -7, 50],
    [64, 46, -62],
    [20, 8, 40],
    [-31, -32, -28],
    [-17, 59, 48],
    [-53, 30, -56],
    [63, 49, -61],
    [-41, 12, 3],
    [1, -52, 42],
    [-11, 64, 66],
    [-64, 15, -45],
    [44, 1, 20],
    [-68, 63, -36],
    [-6, -34, 31],
    [-55, -73, 67],
    [60, 44, -43],
    [75, 56, -20],
    [-3, 66, -4],
    [-3, -58, 15],
    [-29, 43, 9],
    [58, 67, -5],
    [11, -61, -42],
    [-73, -36, -2],
    [-73, 43, 75],
    [-1, 56, -26],
    [-57, -71, -68],
    [3, -60, -20],
    [30, -53, 25],
    [18, 45, -52],
    [-35, 18, -45],
    [-48, -73, -44],
    [-19, 68, 28],
    [-29, 54, 61],
    [-63, -28, 3],
    [-29, -4, -38],
    [47, 37, -52],
    [58, -21, -33],
    [19, -14, -36],
    [-37, 54, -74],
    [60, -48, 46],
    [-75, 18, -71],
    [-17, 16, 19],
    [-32, -45, 17],
    [39, -11, 62],
    [-4, -35, 52],
    [10, 56, -41],
    [3, 48, -14],
    [-25, -55, -10],
    [50, -10, -69],
    [41, 50, -4],
    [-40, -34, 5],
    [-41, -45, -16],
    [-12, 47, -65],
    [-28, 42, 64],
    [-49, -15, 46],
    [-31, 40, 16],
    [35, -5, 34],
    [33, -43, -4],
    [39, 13, 18],
    [56, -60, -43],
    [-37, 13, -7],
    [71, -41, -47],
    [-43, 20, -11],
    [-22, 69, 9],
    [68, 1, -5],
    [3, -64, 74],
    [52, -37, 45],
    [66, 34, 51],
    [72, -26, 75],
    [25, 58, -21],
    [16, 22, 36],
    [-19, 7, 39],
    [19, -63, -70],
    [16, 18, 74],
    [-46, 66, 38],
    [16, -30, -46],
    [48, 67, -12],
    [-55, -40, 29],
    [-49, 75, -39],
    [-65, -38, 28],
    [5, -2, -8],
    [-6, -54, 68],
    [-22, 39, 63],
    [44, -22, 48],
    [5, 31, 57],
    [69, -24, 30],
    [-57, 63, -70],
    [-8, -52, -32],
    [-4, 15, -1],
    [-70, -34, 73],
    [4, -58, 42],
    [-49, 41, -12],
    [-36, 22, -18],
    [-46, -21, 3],
    [-14, -66, 12],
    [46, 38, 71],
    [53, 61, -31],
    [-56, -22, 14],
    [-19, -59, 5],
    [4, 46, 27],
    [-44, -59, -39],
    [-41, -50, 13],
    [41, 72, 23],
    [32, -19, -29],
    [-26, -45, 17],
    [-9, 42, -66],
    [-29, -70, 30],
    [-50, 21, 2],
    [-22, 66, -55],
    [-40, 38, 23],
    [-4, -11, 47],
    [49, -11, -71],
    [8, 27, 71],
    [46, 45, 20],
    [4, -60, -70],
    [32, -45, -9],
    [-5, 13, -2],
    [-50, 24, 6],
    [74, 4, -19],
    [-32, -3, -46],
    [15, -12, -52],
    [24, 63, 43],
    [-73, -28, -27],
    [-42, 64, -54],
    [35, 48, -75],
    [49, -46, 54],
    [67, 13, 17],
    [56, 34, 47],
    [-63, 43, 20],
    [38, -62, -10],
    [-4, -41, 12],
    [11, 56, -14],
    [47, 71, 9],
    [-51, 65, 53],
    [-32, 68, -67],
    [6, 34, 24],
    [18, -27, 70],
    [7, -26, 5],
    [25, 19, 71],
    [-8, 45, -18],
    [58, 16, 7],
    [20, 51, 49],
    [23, 13, 53],
    [33, -53, -40],
    [-53, -63, 23],
    [-44, 49, -51],
    [70, -57, -47],
    [-32, 1, -52],
    [-17, -6, 37],
    [23, 48, -37],
    [63, -3, -42],
    [35, -47, 30],
    [-6, -13, -18],
    [55, -13, 50],
    [-30, 4, -8],
    [60, -10, 43],
    [74, 7, -67],
    [-45, 19, -60],
    [32, -55, -67],
    [-41, 25, -53],
    [-14, 75, -9],
    [-1, -24, -62],
    [40, 21, 18],
    [-4, -39, -72],
    [44, -11, 18],
    [21, -72, -33],
    [-9, -55, -7],
    [69, 12, 4],
    [28, 38, 49],
    [18, 2, 29],
    [67, -43, -9],
    [7, -5, 41],
    [-71, 68, -24],
    [-9, -31, -21],
    [75, 73, 56],
    [-40, -25, -45],
    [-34, -55, -45],
    [12, -64, -36],
    [-19, -71, -69],
    [-19, 52, 48],
    [-1, 44, 29],
    [-10, -50, -57],
    [-22, 62, 38],
    [20, -41, -14],
    [24, -49, -35],
    [-22, 21, -67],
    [-1, -12, 51],
    [-1, -47, 62],
    [2, -35, 30],
    [3, 62, -75],
    [-1, 30, 73],
    [61, 22, 46],
    [-60, -2, -4],
    [58, 62, -32],
    [39, -4, -57],
    [15, 41, -20],
    [46, -19, -63],
    [-49, 39, -65],
    [49, 68, 36],
    [-1, 44, 40],
    [-48, 20, 45],
    [33, 3, -21],
    [-9, -68, -38],
    [48, 19, -41],
    [44, 24, 15],
    [-14, -54, -40],
    [61, 4, 74],
    [-6, 32, -11],
    [-17, 3, 74],
    [-28, -55, -46],
    [63, -2, 31],
    [24, -46, 5],
    [-40, 57, 60],
    [30, 41, 18],
    [50, 51, -7],
    [72, 5, -71],
    [28, 56, 26],
    [-60, 42, 59],
    [59, -47, -49],
    [28, -49, -47],
    [28, 66, 70],
    [3, 45, 7],
    [30, 61, -51],
    [-21, 12, -40],
    [65, -40, 13],
    [-26, 73, -20],
    [52, -60, -53],
    [-34, -46, 38],
    [-67, 11, 70],
    [50, -63, -46],
    [-37, -12, -51],
    [27, -37, 50],
    [66, -75, 6],
    [-58, 37, -17],
    [-10, 72, 27],
    [34, 44, 25],
    [-74, -51, 48],
    [9, -45, -13],
    [20, 55, -21],
    [1, 41, -39],
    [-40, -55, -16],
    [-75, 63, -16],
    [-60, -45, 40],
    [56, -5, -17],
    [43, -41, 13],
    [-53, 33, 14],
    [-32, -21, 64],
    [43, -52, -70],
    [-45, 29, 59],
    [-33, 72, -65],
    [5, -55, 15],
    [20, -4, -57],
    [33, 19, -26],
    [-6, -71, -28],
    [13, -15, -53],
    [-59, 65, 34],
    [34, 27, -10],
    [64, 68, 4],
    [13, 26, 40],
    [27, 22, -73]
  ]

problem100 =
  [ [-46, 90, 77],
    [-100, -61, -2],
    [5, -95, 79],
    [-34, -56, -23],
    [80, 66, 70],
    [-82, 54, -34],
    [-77, 28, 33],
    [36, -17, -7],
    [-40, -90, -25],
    [55, -59, -46],
    [68, 56, 8],
    [74, -91, -62],
    [18, 5, 91],
    [94, 58, 37],
    [-98, 74, -43],
    [66, 4, 67],
    [-9, -100, -46],
    [-82, 64, -89],
    [-57, -48, -100],
    [51, -37, 40],
    [-14, 89, -40],
    [-20, -15, 77],
    [30, -74, 14],
    [-100, 30, 71],
    [97, 57, -70],
    [73, -18, 43],
    [-89, -18, -65],
    [15, 13, 30],
    [52, 31, -22],
    [-26, -93, -25],
    [35, 14, -22],
    [35, -29, 100],
    [-24, 21, -42],
    [85, -53, -15],
    [40, -81, -93],
    [-37, 92, -93],
    [18, 31, -98],
    [-32, 66, 9],
    [-66, 4, -83],
    [49, -57, 52],
    [13, -95, 21],
    [-68, 95, -55],
    [-54, 44, -62],
    [-93, -82, 85],
    [-46, -10, 58],
    [27, -64, -12],
    [71, 37, -85],
    [-21, 56, -40],
    [63, -10, -37],
    [48, 30, -8],
    [23, -55, 34],
    [-72, 28, 7],
    [-17, 84, -42],
    [61, -11, 34],
    [-55, -26, -38],
    [83, 7, 19],
    [39, -80, -38],
    [-49, -92, -50],
    [88, -50, -62],
    [-51, -12, 83],
    [85, -54, 42],
    [-14, -9, 29],
    [-17, -3, -96],
    [-18, 81, -36],
    [37, 53, -3],
    [-54, 26, -28],
    [-44, -43, -6],
    [-76, -11, -63],
    [-57, -95, 38],
    [-84, 11, 91],
    [-61, -83, -58],
    [-86, -20, 29],
    [51, 68, 33],
    [71, -96, -4],
    [47, -71, 89],
    [70, 18, -100],
    [13, -92, -96],
    [-64, 33, -55],
    [5, 18, -89],
    [-87, 72, 47],
    [-93, 78, 22],
    [-68, -17, 19],
    [51, 22, -34],
    [98, 22, -87],
    [-18, 95, 9],
    [-85, -82, -34],
    [44, -2, -81],
    [-58, -81, -16],
    [60, 20, 94],
    [8, -67, 11],
    [-28, 43, -95],
    [24, -63, 82],
    [86, -27, 22],
    [-98, -49, -38],
    [8, 2, 54],
    [33, 45, -55],
    [-8, 30, 36],
    [31, 20, -52],
    [19, -68, -7],
    [18, -64, -48],
    [-69, 26, -14],
    [-4, -62, 23],
    [-23, 16, -58],
    [-44, 55, 51],
    [81, 69, 91],
    [-85, 75, -64],
    [-85, -68, -73],
    [-1, 80, 57],
    [-18, 70, -77],
    [12, 15, -51],
    [53, -16, -74],
    [67, -81, 48],
    [-39, 58, 91],
    [28, 50, 76],
    [86, 30, -24],
    [36, -84, -70],
    [90, 67, 46],
    [49, 45, -62],
    [46, -68, -44],
    [-31, -58, 90],
    [-9, 30, 5],
    [-43, -28, -72],
    [-92, -14, -22],
    [-47, 99, -29],
    [51, 57, -40],
    [-13, 79, -67],
    [33, 46, 42],
    [-12, -25, 40],
    [12, -76, 29],
    [-51, 46, 85],
    [52, -63, 14],
    [89, 85, -77],
    [-49, -17, -12],
    [90, -93, -64],
    [47, 44, -5],
    [-66, 86, -17],
    [-10, 92, -53],
    [-73, -70, -74],
    [73, -48, 47],
    [-96, 13, 83],
    [-54, -9, 2],
    [-39, -97, 96],
    [48, 55, 87],
    [76, 12, -93],
    [61, 44, 71],
    [-60, -97, 23],
    [-65, -6, -60],
    [-44, -42, 63],
    [-40, 92, -99],
    [-23, 84, 28],
    [-25, -24, -64],
    [50, -96, -79],
    [86, 36, -8],
    [-55, 41, 80],
    [10, -25, 2],
    [79, -15, 52],
    [-16, -49, 37],
    [-60, -44, -65],
    [55, -46, 6],
    [-53, 8, 33],
    [83, -25, 37],
    [76, -83, 84],
    [41, 38, -85],
    [-71, -59, 20],
    [85, 46, -26],
    [-39, 84, -96],
    [-11, 93, 46],
    [36, -46, -60],
    [95, -22, 23],
    [-33, -83, -60],
    [30, 39, -44],
    [87, 25, -53],
    [-54, -3, -14],
    [-67, -75, 99],
    [-13, -56, 73],
    [100, 94, 77],
    [11, 32, 89],
    [97, -3, 49],
    [-87, 42, 77],
    [-98, 35, -5],
    [-4, 6, -53],
    [16, -41, 92],
    [-51, -80, 44],
    [-1, -76, -60],
    [27, 58, 17],
    [90, 32, -28],
    [-3, 27, -98],
    [-35, -83, 60],
    [-96, -83, -25],
    [-37, 86, -41],
    [76, 7, 100],
    [-60, 52, -38],
    [-37, -81, 51],
    [-46, 54, -15],
    [-54, -46, -61],
    [-63, -75, 83],
    [74, -37, 83],
    [79, 30, -8],
    [-62, 72, 20],
    [51, -95, -75],
    [-88, 52, 49],
    [-2, -88, -62],
    [12, 77, 85],
    [86, 68, 83],
    [35, 95, 19],
    [84, -94, -59],
    [57, 66, -60],
    [-73, -61, 34],
    [68, -66, -8],
    [-74, 5, -47],
    [-99, 98, 47],
    [-30, 86, 76],
    [-47, 77, -86],
    [21, -1, 32],
    [79, 25, 8],
    [77, -14, 19],
    [34, -100, 33],
    [35, 13, -20],
    [-36, -47, 18],
    [-42, 21, 27],
    [-43, 51, 66],
    [99, 21, -45],
    [-42, -44, 92],
    [-48, -95, -84],
    [85, -99, 1],
    [59, -8, 88],
    [-36, -72, 29],
    [-60, -22, 82],
    [-90, -31, -36],
    [-53, -80, -93],
    [-91, -49, 64],
    [-87, -9, -16],
    [49, -10, -35],
    [-90, 24, 12],
    [-15, -99, -98],
    [59, 38, -18],
    [23, 19, -64],
    [92, -55, -61],
    [3, 45, -77],
    [20, -21, -95],
    [-71, -47, 22],
    [44, 7, -50],
    [58, -37, -11],
    [72, -66, 10],
    [44, 99, 37],
    [21, -86, -72],
    [73, 17, 61],
    [-78, -81, 42],
    [54, 70, -64],
    [-61, -48, 17],
    [-19, 48, -13],
    [-33, -39, 29],
    [33, 43, -76],
    [76, 11, -49],
    [19, -88, 45],
    [-76, -5, -55],
    [-57, -98, -15],
    [19, -86, -94],
    [82, -70, 22],
    [-39, -85, -63],
    [50, 75, 25],
    [-96, -37, -15],
    [-99, -75, -10],
    [-67, -63, 38],
    [-7, -22, -18],
    [-39, -45, 62],
    [-64, -79, 37],
    [-69, -58, -100],
    [-46, 17, 43],
    [17, -11, 46],
    [-22, -19, -86],
    [84, 45, 48],
    [46, -91, 64],
    [-25, -15, 30],
    [92, 14, 45],
    [-79, -69, 43],
    [-34, -35, -69],
    [87, 1, -82],
    [-64, 70, -65],
    [-27, -29, 75],
    [95, 45, 90],
    [62, 43, 76],
    [21, -11, -31],
    [53, 24, -46],
    [-78, 43, -12],
    [-74, 9, 22],
    [-5, 7, -73],
    [12, -57, -7],
    [-19, 12, 90],
    [-47, -6, -50],
    [-35, -32, 72],
    [-87, -100, -24],
    [-56, 92, -16],
    [29, 53, 87],
    [-25, 64, -20],
    [37, 57, 9],
    [25, -100, -4],
    [7, -16, 77],
    [-98, 7, -64],
    [98, 50, -44],
    [95, -60, 23],
    [7, 92, -35],
    [-95, -47, -9],
    [82, -67, 93],
    [-25, -49, -66],
    [-34, -60, 49],
    [91, -70, 8],
    [20, 75, -94],
    [15, -27, -30],
    [-24, -95, -29],
    [78, -98, 53],
    [-43, -44, -86],
    [-98, 89, -40],
    [-55, 31, -12],
    [-64, 60, 77],
    [86, -27, -37],
    [55, 96, 34],
    [5, 44, 92],
    [30, -90, -39],
    [-23, 38, -36],
    [-40, -16, -12],
    [-67, 8, 61],
    [-4, -52, -51],
    [4, -26, 76],
    [-18, -89, 87],
    [-39, 27, -32],
    [-15, -69, 94],
    [83, -72, -93],
    [-19, 70, -14],
    [45, -30, -69],
    [-48, -22, -83],
    [-66, -87, 55],
    [-100, -45, -96],
    [-81, -97, 32],
    [75, -36, -73],
    [-98, -14, 78],
    [66, 59, -36],
    [44, 17, 43],
    [1, -89, 16],
    [75, -58, 42],
    [-4, -98, 22],
    [-31, -44, -73],
    [64, 7, 6],
    [26, -45, -3],
    [-48, -52, 44],
    [98, -3, 40],
    [35, -15, 61],
    [97, 44, -30],
    [16, 75, -19],
    [4, -63, 46],
    [91, -51, 48],
    [48, 5, 46],
    [-31, 7, 70],
    [-35, 24, 93],
    [-48, -46, 71],
    [-39, 84, 74],
    [-18, -61, -48],
    [-89, -99, -66],
    [-76, 93, 98],
    [76, -94, -86],
    [69, 26, -62],
    [87, -30, 35],
    [-93, 81, -100],
    [33, -14, -51],
    [-70, 58, -89],
    [-33, 72, 2],
    [69, 1, 43],
    [6, -28, -16],
    [64, 18, 68],
    [-10, -18, 7],
    [-75, -5, -82],
    [89, -68, 97],
    [-66, -77, 59],
    [35, -45, 63],
    [-51, -68, -28],
    [67, 40, 4],
    [45, 5, 71],
    [72, -1, -19],
    [76, 16, 45],
    [-49, 69, 70],
    [-75, 93, -76],
    [-82, 86, 96],
    [95, 98, 32],
    [-13, 5, 29],
    [60, -91, 14],
    [65, 42, -33],
    [32, -2, -59],
    [-57, -48, 82],
    [1, 73, -15],
    [-76, 89, 48],
    [-29, 83, -55],
    [-35, -54, 76],
    [77, 37, -59],
    [-26, 10, 83],
    [30, 28, 87],
    [48, 28, 56],
    [43, -3, 6],
    [-12, 20, 11],
    [38, 69, -57],
    [61, -54, -23],
    [48, 20, 96],
    [33, 71, 48],
    [-72, -17, -49],
    [-30, 24, -62],
    [82, -4, 39],
    [-73, 99, -30],
    [-12, -33, 29],
    [90, 42, 50],
    [-31, 53, 60],
    [78, 20, -7],
    [-26, -97, -56],
    [14, 76, -89],
    [76, -24, 100],
    [61, -93, 75],
    [24, -62, -33],
    [88, -3, 52],
    [-100, 72, 91],
    [47, 89, 49],
    [69, -75, -2],
    [-57, 18, 47],
    [-45, -35, -26],
    [11, -78, -55],
    [-26, -13, -57],
    [-84, -28, 45],
    [71, 28, 57],
    [-41, -60, 39],
    [50, -67, -94],
    [73, -94, 72],
    [99, 51, 58],
    [81, 7, -57]
  ]
